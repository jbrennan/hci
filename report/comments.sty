\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{comments}[2012/03/26 TODO comments]
\RequirePackage{color}
\RequirePackage{ifthen}

\newboolean{comment@draft}\setboolean{comment@draft}{false}
\newboolean{comment@used}\setboolean{comment@used}{false}

\DeclareOption{draft}{\setboolean{comment@draft}{true}}
\DeclareOption{final}{\setboolean{comment@draft}{false}}
\ProcessOptions\relax

\ifthenelse{\boolean{comment@draft}}%
    {\newcommand{\comment}[1]{%
        \setboolean{comment@used}{true}%
        \par%
        \bgroup{\color{red}\small\sf #1}\egroup%
        \par%
    }}
    {\newcommand{\comment}[1]{\setboolean{comment@used}{true}}}

% Comments are not intended to make it into the final document!
\PackageInfo{comments}{Comments hidden}
\AtEndDocument{%
    \ifthenelse{\boolean{comment@used}\AND\NOT\boolean{comment@draft}}%
        {\PackageWarning{comment}{Comments suppressed for 'final' mode}}%
        {}}

